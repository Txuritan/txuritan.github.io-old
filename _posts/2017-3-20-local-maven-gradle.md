--- 
title: Using a local folder as a Maven repository using Gradle
layout: post
disqusid: local-maven-gradle
category: post
---

Just learned that you are able to use a local folder as a Maven repository using the ```maven-publish``` Gradle plugin.

To start you will need a Gradle propject with a ```gradle.properties``` file, if one does not exsist create one.

A normal ```build.gradle``` would look something like this (auto generated by Intellij Idea).

```groovy
group 'com.github.txuritan.maven.test'
version '1.0-SNAPSHOT'

apply plugin: 'java'

sourceCompatibility = 1.5

repositories {
    mavenCentral()
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.11'
}
```

We will first need the ```maven-publish``` plugin add that below the ```java``` plugin.

```groovy
apply plugin: 'java'
apply plugin: 'maven-publish'
```

We will now add the task to publish the .jar to the Maven repository.

```groovy
publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
            artifact sourceJar {
                classifier "sources"
            }
        }
    }
    repositories {
        maven {
            url "file:" + project.localMavenPath
        }
    }
}
```

The need for a ```gradle.properties``` file is beacuse of the ```project.localMavenPath``` property.

Add something along these lines in your ```gradle.properties``` file.
```groovy
localMavenPath="C:/Users/txurt/maven-repository"
```

```"C:/Users/txurt/maven-repository"``` is where my local Maven repository is on my machine. **Note to Windows users DO NOT USE ```\\``` AS A PATH SEPARATOR this will cause the following task to crash.**

So your local Maven repository has now been made and contains a dependency, but if you use Intellij Idea like I do you will not be able to index it.

To be able to index your repository you will a external jar (for now untill I make the Gradle plugin) [this one to be exact](https://builds.apache.org/job/maven-indexer/249/org.apache.maven.indexer$indexer-cli/).

Download and move it to your Gradle project root (where your ```build.gradle``` and ```gradle.properties``` are).

Then add the following to your ```build.gradle``` to be able to index your local Maven repository.

```groovy
task indexRepository(type: JavaExec) {
    main = "-jar"
    args = [
            "indexer-cli-6.0-SNAPSHOT.jar",
            "-r",
            project.localMavenPath,
            "-i",
            project.localMavenPath + "/.index",
            "-d",
            project.localMavenPath + "/.index"
    ]
}
```

In the end your entire ```build.gradle``` file should look like this.

```groovy
group 'com.github.txuritan.maven.test'
version '1.0-SNAPSHOT'

apply plugin: 'java'
apply plugin: 'maven-publish'

sourceCompatibility = 1.5

repositories {
    mavenCentral()
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.11'
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
            artifact sourceJar {
                classifier "sources"
            }
        }
    }
    repositories {
        maven {
            url "file:" + project.localMavenPath
        }
    }
}

task indexRepository(type: JavaExec) {
    main = "-jar"
    args = [
            "indexer-cli-6.0-SNAPSHOT.jar",
            "-r",
            project.localMavenPath,
            "-i",
            project.localMavenPath + "/.index",
            "-d",
            project.localMavenPath + "/.index"
    ]
}
```

And your ```gradle.properties``` file like this.
```groovy
localMavenPath="C:/Users/txurt/maven-repository"
```
